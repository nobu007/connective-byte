# バックエンドテストカバレッジ改善ワークフロー

## 目的
`connective-byte`プロジェクトのバックエンドテストカバレッジを継続的に改善し、コード品質と信頼性を向上させる。特に、`IMPROVEMENT_ROADMAP.md`のQ2目標である「バックエンドテストカバレッジ向上 (目標: 70%)」を達成し、さらにその先の100%カバレッジを目指す。

## ワークフロー

### ステップ 1: ロードマップと現状の把握
1.  `IMPROVEMENT_ROADMAP.md`を読み、プロジェクトの品質目標と優先順位を理解する。
2.  `FINAL_TEST_REPORT.md`や`TEST_RESULTS_SUMMARY.md`など、既存のテスト関連ドキュメントを確認し、現状のテスト状況を把握する。

### ステップ 2: CI/CDパイプラインの確認と修正
1.  `.github/workflows/ci.yml`ファイルを確認し、CIパイプラインがロードマップの要件（例: linting、テスト実行、カバレッジ計測）を満たしているか検証する。
2.  `package.json`ファイル（ルート、`apps/frontend`、`apps/backend`）を確認し、テストコマンドやlintコマンドが正しく定義されているか確認する。
3.  CIパイプラインに不備がある場合、`ci.yml`を修正し、ロードマップの要件を満たすように更新する。

### ステップ 3: ローカルでのカバレッジ計測と分析
1.  `apps/backend`ディレクトリで`npm test -- --coverage`コマンドを実行し、最新のバックエンドテストカバレッジレポートを生成する。
2.  生成されたカバレッジレポートを分析し、特にカバレッジが低いファイルや、未カバーのステートメント、ブランチ、関数、行を特定する。
    *   **MCPへの指示:** カバレッジレポートの「Uncovered Line #s」に注目し、未カバーのコード行を特定してください。

### ステップ 4: 未カバーコードの調査とテストケースの追加
1.  特定された未カバーのファイル（例: `src/index.ts`, `src/middleware/errorHandler.ts`）の内容を読み、未カバーとなっているコードの機能と役割を理解する。
    *   **MCPへの指示:** 未カバーのコードが意図的にテストされていない（例: エントリーポイントの起動ロジックなど、テストフレームワークの外部で実行されるべきコード）のか、それともテストが不足しているのかを判断してください。
2.  未カバーのコードがテストされるべきビジネスロジックや重要な機能である場合、既存のテストファイル（例: `src/__tests__/`ディレクトリ内の関連テストファイル）に適切なテストケースを追加する。
    *   **MCPへの指示:** 新しいテストケースは、未カバーのステートメント、ブランチ、関数を網羅するように設計してください。異常系、境界値、エッジケースを考慮に入れることが重要です。
3.  テストケースを追加した後、再度`npm test -- --coverage`を実行し、カバレッジが向上したことを確認する。

### ステップ 5: コードのコミットとプッシュ
1.  テストコードの追加または修正が完了し、カバレッジが目標を達成したことを確認した後、変更をコミットする。
2.  コミットメッセージは、追加されたテストの目的と、それがどのカバレッジを改善したかを明確に記述する。
3.  変更をリモートリポジトリにプッシュし、CIパイプラインが正常に動作することを確認する。

### ステップ 6: 再帰的な改善
1.  ステップ3に戻り、再度カバレッジレポートを分析し、次の改善対象となる未カバーコードを特定する。
2.  このプロセスを繰り返し、バックエンドテストカバレッジを継続的に向上させる。

## MCPへの具体的な指示

現在、`src/index.ts`のライン12-14と`src/middleware/errorHandler.ts`のライン19-23が未カバーとして特定されています。

1.  まず、`/home/jinno/connective-byte/apps/backend/src/index.ts`の内容を読み、ライン12-14が未カバーである理由を調査してください。
2.  次に、`/home/jinno/connective-byte/apps/backend/src/middleware/errorHandler.ts`の内容を読み、ライン19-23が未カバーである理由を調査してください。
3.  それぞれのファイルについて、未カバーのコードがテストされるべきかどうかを判断し、必要であればテストケースを追加する計画を立ててください。
