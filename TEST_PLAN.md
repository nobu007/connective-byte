# 包括的試験計画書 (TEST_PLAN.md)

## 1. 試験概要

本計画は、`connective-byte` プロジェクトの品質を保証するため、フロントエンド、バックエンド両面にわたる包括的な試験を定義するものである。

- **対象システム**: `connective-byte` プロジェクト全体
- **分析レポート**: `SYSTEM_ANALYSIS.md` に基づく
- **目標**:
    - システム全体の成功率: 95%以上
    - クリティカルな問題: 0件
    - バックエンドのテストカバレッジ: 50%以上 (初期目標)
    - フロントエンドのテストカバレッジ: 既存の仕組みを維持・向上

## 2. 試験カテゴリと優先度

| 試験カテゴリ | 優先度 | 対象と目的 |
| :--- | :--- | :--- |
| **単体試験** | **高** | **Backend**: 各APIエンドポイントの基本動作確認 (CRUD)。 **Frontend**: 既存のJestテストの維持・拡充。 |
| **統合試験** | **中** | **Backend-Frontend**: API連携の動作確認。フロントエンドからのAPI呼び出しが正しく処理されるか。 **Backend**: `liquid-to-html.js`スクリプトと他モジュールの連携確認。 |
| **システム試験 (E2E)** | **高** | **Frontend**: Playwrightによる主要なユーザーシナリオ（例: ページ表示、フォーム送信）の動作確認。 |
| **障害試験** | **低** | 異常な入力（例: 不正な形式のAPIリクエスト）に対するエラーハンドリングの確認。 |
| **性能試験** | **低** | 主要APIのレスポンスタイム、Next.jsのビルド時間などを簡易的に計測。 |
| **セキュリティ試験** | **低** | `.env`ファイル等の機密情報がリポジトリに含まれていないかの確認。 |

## 3. 試験項目詳細

### Phase A: 基盤整備と単体試験 (優先度: 高)

1.  **Backend: テスト環境構築**
    - **内容**: `apps/backend` に `tests` ディレクトリを作成。Jestの設定を見直し、テスト実行環境を整備する。
    - **成功基準**: `npm test` コマンドが `apps/backend` で正常に実行できる。
2.  **Backend: API単体試験**
    - **内容**: `supertest` を用いて、主要APIエンドポイントの基本的なテストケースを作成する。(例: `GET /api/items`, `POST /api/items`)
    - **成功基準**: 各エンドポイントが期待されるステータスコードとレスポンスボディを返す。
3.  **Frontend: 既存単体試験の実行**
    - **内容**: `apps/frontend` で `npm test` を実行し、既存のJestテストがすべてパスすることを確認する。
    - **成功基準**: 全てのテストケースが成功する。

### Phase B: 統合試験とシステム試験 (優先度: 中〜高)

1.  **Frontend: E2Eテスト実行**
    - **内容**: `apps/frontend` で `npm run test:e2e` を実行し、既存のPlaywrightテストがすべてパスすることを確認する。
    - **成功基準**: 全てのE2Eテストシナリオが成功する。
2.  **Frontend-Backend: API連携試験**
    - **内容**: フロントエンドからバックエンドAPIを呼び出すシナリオをテストする。MSWでモックされている箇所を、実際のバックエンドに接続して確認する。
    - **成功基準**: フロントエンドが必要なデータをバックエンドから取得・表示・更新できる。
3.  **Backend: スクリプト連携試験 (保留)**
    - **内容**: `liquid-to-html.js` スクリプトが、他のモジュールと連携して正しくHTMLを生成できるか確認する。ただし、botアプリケーションが未実装のため、この試験は保留とします。
    - **成功基準**: Liquidテンプレートから期待通りのHTMLファイルが出力される。

### Phase C: 応用試験 (優先度: 低)

1.  **障害試験**
    - **内容**: APIに意図的に不正なリクエストを送信し、サーバーがクラッシュせず、適切なエラーレスポンスを返すか確認する。
    - **成功基準**: 500番台のエラーではなく、400番台の適切なエラーが返される。
2.  **性能測定**
    - **内容**: 主要APIのレスポンスタイムを`console.time`等で簡易的に計測する。
    - **成功基準**: レスポンスタイムに極端な遅延がないことを確認する (例: 2000ms以内)。

## 4. 実行スケジュール

- **Phase 1 (分析・計画)**: 完了
- **Phase 2 (試験実行)**:
    - **Week 1**: Phase A (基盤整備と単体試験) を完了させる。
    - **Week 2**: Phase B (統合試験とシステム試験) を完了させる。
    - **Week 3**: Phase C (応用試験) を実施し、結果をまとめる。
- **Phase 3 (結果分析・修正)**: 各試験フェーズ完了後に随時実施。
- **Phase 4 (継続改善)**: 全ての試験完了後、`IMPROVEMENT_ROADMAP.md` を作成する。

## 1. 試験概要

このドキュメントは、`connective-byte`プロジェクトの品質を保証するための包括的な試験計画を定義します。システム分析フェーズで特定された問題の修正と、それに続く段階的なテスト実行を通じて、システムの堅牢性を検証します。

## 2. 試験フェーズと実行計画

### Phase A: 環境修正と検証

**目的**: フロントエンドとバックエンド間の通信を確立し、テスト実行の前提条件を整える。

| # | テスト項目 | 実行手順 | 成功基準 |
| :-- | :--- | :--- | :--- |
| A-1 | APIプロキシ設定の追加 | `apps/frontend/next.config.js` に、`/api` へのリクエストを `http://localhost:3001` に転送する設定を追加する。 | Next.js開発サーバーがプロキシ設定を認識して再起動する。 |
| A-2 | 性能テストによる修正検証 | `npm run test:e2e -- e2e/performance.spec.ts` を実行する。 | テストが成功し、APIレスポンスタイムが500ms未満であることが確認される。 |

### Phase B: 単体・統合試験

**目的**: 各アプリケーションの個別コンポーネントとモジュール間連携が正常に動作することを確認する。

| # | テスト項目 | 実行手順 | 成功基準 |
| :-- | :--- | :--- | :--- |
| B-1 | フロントエンド単体・統合試験 | `cd apps/frontend && npm test` を実行する。 | 全てのJestテストスイートが成功する。 |
| B-2 | バックエンド単体・統合試験 | `cd apps/backend && npm test` を実行する。 | 全てのJest/Supertestテストスイートが成功する。 |

### Phase C: システム試験 (E2E)

**目的**: ユーザー視点でアプリケーション全体のワークフローが正常に完了することを確認する。

| # | テスト項目 | 実行手順 | 成功基準 |
| :-- | :--- | :--- | :--- |
| C-1 | フロントエンドE2E試験 | `cd apps/frontend && npm run test:e2e -- e2e/example.spec.ts` を実行する。 | Playwrightが全てのブラウザでHomePageの表示を正常に検証できる。 |

### Phase D: 障害試験

**目的**: 予期せぬエラー発生時のシステムの挙動と回復性を確認する。

| # | テスト項目 | 実行手順 | 成功基準 |
| :-- | :--- | :--- | :--- |
| D-1 | APIエラーハンドリング検証 | `apps/frontend`の`HealthCheck.test.tsx`に含まれるエラーケーステストが成功することを確認する (Phase B-1でカバー)。 | APIエラー時にUIが適切にエラー表示を行うことがテストで検証されている。 |

### Phase E: 性能試験

**目的**: システムの応答性能が要求仕様を満たしていることを確認する。

| # | テスト項目 | 実行手順 | 成功基準 |
| :-- | :--- | :--- | :--- |
| E-1 | API応答性能測定 | Phase A-2で実行済み。結果を`TEST_PROGRESS.md`に記録する。 | APIの平均応答時間が規定値（500ms）以内である。 |

### Phase F: セキュリティ試験 (将来実装)

**目的**: 潜在的な脆弱性を特定し、システムの安全性を確保する。

| # | テスト項目 | 実行手順 | 成功基準 |
| :-- | :--- | :--- | :--- |
| F-1 | 認証・認可 | (未定義) | (未定義) |
| F-2 | 機密情報の取り扱い | (未定義) | (未定義) |

## 3. 進捗管理

- 全ての試験結果と進捗は `TEST_PROGRESS.md` にリアルタイムで記録される。
- 各フェーズの完了時にサマリーを更新する。

## 1. はじめに

このドキュメントは、`connective-byte`プロジェクトの品質を保証するための包括的な試験計画を定義します。`SYSTEM_ANALYSIS.md`の分析結果に基づき、各コンポーネントおよびシステム全体の動作を検証することを目的とします。

## 2. 試験カテゴリと方針

以下のカテゴリで試験を実施します。

| カテゴリ | 対象 | 方針 |
| :--- | :--- | :--- |
| **単体試験** | 各エージェント・主要モジュール | フロントエンドの既存テストを拡充し、バックエンドのテストを新規に導入する。 |
| **統合試験** | フロントエンド ⇔ バックエンド | API連携が仕様通りに動作することを確認する。 |
| **システム試験** | ユーザーシナリオ | 主要なユースケースがエンドツーエンドで正常に完了することを確認する。 |
| **障害試験** | エラーハンドリング | APIエラーや不正な入力に対するシステムの挙動を確認する。 |
| **性能試験** | APIレスポンスタイム | 主要APIの性能を測定し、ボトルネックを特定する。 |
| **セキュリティ試験**| 認証・認可 | 機密情報へのアクセス制御が正しく機能することを確認する。 |

## 3. 優先度とリスク分析

| 優先度 | リスク項目 | 具体的な内容 | 対応策 |
| :--- | :--- | :--- | :--- |
| **最優先** | バックエンドのテスト不在 | APIの品質が保証されておらず、バグが混入しやすい。 | JestとSupertestを導入し、主要APIの単体・統合テストを整備する。 |
| **高** | エージェント間連携のテスト不足 | フロントエンドとバックエンドの結合部分に問題が発生しやすい。 | APIのモックを活用し、フロントエンド側での統合テストを強化する。 |
| **中** | Botの未実装 | Bot機能に関する品質評価が全く行えない。 | Botの実装が開始され次第、速やかにテスト計画を策定する。 |

## 4. 試験実行計画 (Phase別)

### Phase 1: 基盤整備 (本計画の主眼)

**目標**: バックエンドのテスト環境を構築し、主要な機能の品質を担保する。

| 試験項目 | 実行手順 | 成功基準 |
| :--- | :--- | :--- |
| **[単体] Backend: Jest/Supertest導入** | 1. `jest`, `supertest`, `@types/jest`, `@types/supertest`をインストール。<br>2. `jest.config.js`を作成。<br>3. `package.json`に`"test": "jest"`スクリプトを追加。 | `npm test`コマンドがエラーなく実行できる。 |
| **[単体] Backend: 主要APIテスト** | 1. `/api/health`のような単純なエンドポイントのテストを作成。<br>2. 正常系（200 OK）と異常系（404 Not Found）を確認。 | テストが成功し、期待通りのレスポンスコードとボディが返却される。 |
| **[単体] Frontend: 既存テストの拡充** | 1. `apps/frontend`で`npm test`を実行。<br>2. 主要コンポーネントのレンダリングテストを追加。 | 既存テストがすべてパスし、新規テストも成功する。 |

### Phase 2: 統合・システム試験

**目標**: エージェント間の連携を強化し、システム全体の安定性を向上させる。

| 試験項目 | 実行手順 | 成功基準 |
| :--- | :--- | :--- |
| **[統合] API連携テスト** | 1. フロントエンド側で、バックエンドAPIを呼び出す処理のテストを作成。<br>2. APIモック（MSWなど）を導入し、正常・異常レスポンスをシミュレート。 | APIのレスポンスに応じてUIが正しく更新されることを確認する。 |
| **[システム] E2Eテスト導入** | 1. PlaywrightやCypressのようなE2Eテストフレームワークを導入。<br>2. ユーザー登録からログイン、主要操作までの一連のシナリオを作成。 | すべてのE2Eテストシナリオが正常に完了する。 |

### Phase 3: 非機能要件試験

**目標**: 性能やセキュリティといった非機能要件を評価し、改善する。

| 試験項目 | 実行手順 | 成功基準 |
| :--- | :--- | :--- |
| **[性能] APIレスポンスタイム測定** | 1. `k6`や`autocannon`などの負荷試験ツールを導入。<br>2. 主要APIに対して負荷をかけ、レスポンスタイムを測定。 | レスポンスタイムが規定の閾値（例: 500ms）以内である。 |
| **[セキュリティ] 脆弱性スキャン** | 1. `npm audit`やSnykなどのツールで依存関係の脆弱性をスキャン。<br>2. コードに対する静的解析（SAST）を実施。 | 重大な脆弱性が検出されない。 |

## 5. 成功基準

- Phase 1で定義されたすべてのテスト項目が成功すること。
- バックエンドのテストカバレッジが一定の閾値（例: 60%）に到達すること。

## 6. 今後の展望

本計画で定義されたテストが継続的に実行され、品質が維持されるよう、将来的にはCI/CDパイプラインへのテスト自動化の組み込みを推奨します。
